
# システム設計書

## 1. 概要
### 1.1 システム全体像
本システムは、ユーザー同士のP2P接続によるネットワーク構築を前提としたほぼ完全分散型のSNSです。主な特徴は以下の通りです：
- **P2P接続**: IPFSを利用し、ユーザー間でデータを直接やり取り。
- **分散型データベース**: OrbitDBを使用し、ノードローカルではSQLiteを併用。
- **マルチプラットフォーム対応**: モバイルアプリはReactNativeExpoのManagedWorkflow、PCアプリはReactNativeWebをElectronで動作。

### 1.2 システムの目的
- 中央集権的なサーバー依存を最小限に抑えたSNSの構築。
- ユーザー自身のデータ管理を可能にし、セキュリティとプライバシーを向上。
- 分散型ネットワークにおける効率的なデータ共有と同期。

---

## 2. システム構成
### 2.1 ネットワーク設計
- **IPFS**: P2P通信とデータ保存を担う。
- **OrbitDB**: 分散型データベースとしてユーザー投稿や設定を管理。
- **SQLite**: 各ノードのローカルデータ保存に利用。

### 2.2 モバイルアプリとPCアプリ
- **モバイルアプリ**: ReactNativeExpoを使用した軽量設計。
- **PCアプリ**: Electronを用いてWeb技術で動作し、Node.jsとPythonを同梱。

---

## 3. 主要機能
### 3.1 投稿機能
- **短文投稿**: 最大140文字のテキスト投稿。
- **ブックマーク機能**: 投稿をブックマークし、後で参照可能。
- **リプライ・リポスト・引用リポスト**: ユーザー間の投稿インタラクション。
- **いいね機能**: 投稿への簡単なフィードバック。

### 3.2 フォロー機能
- 他ユーザーをフォローし、投稿をタイムラインに表示。
- フォローユーザーのオンライン/オフライン表示。

### 3.3 通知機能
- リアルタイムでフォローユーザーの投稿やインタラクションを通知。

### 3.4 デバイス間同期
- 自身の投稿データや設定をデバイス間で同期。

### 3.5 投稿削除機能
- 自分の投稿を削除可能（編集は非対応）。

### 3.6 ユーザーと投稿のレポート機能
- **レポート作成**: ユーザーや投稿に対するレポート作成。
- **投票機能**: レポートに対する評価（役に立った/立たなかった）。
- 信頼スコア導入後はスコアに応じたレポート権限の制御を予定。

### 3.7 ブロック機能
- ブロックされたユーザーの投稿は閲覧可能だが、リプライやインタラクションは不可。

---

## 4. サーバー設計
### 4.1 サーバーの役割
- **Bootstrapノードとしての機能**: IPFSネットワークで初期接続を提供。
- **特殊なノードとしての機能**: ユーザー情報を持たない設計。

### 4.2 データ管理と復元
- サーバーは秘密鍵を保持し、IPFSネットワークの公開鍵認証を実施。
- **DB復元**: OrbitDBの情報からサーバーDBを再構築。
- IPFS上のバックアップにより、消失時の復元を可能に。

---

## 5. 認証とセキュリティ
### 5.1 公開鍵暗号による認証
1. 接続リクエストの署名: クライアントが秘密鍵で署名。
2. 署名検証: 接続先が公開鍵を使用してリクエストを確認。
3. 認証成立: 有効な署名で接続確立。

### 5.2 データ保護
- **メールアドレス認証**: ユーザー登録時に実施。
- **秘密鍵管理**: クライアント・サーバー・IPFSで分割保存し、安全性を確保。

---

## 6. 投稿データ管理
- ノード自身の投稿はローカルDBに保存し、IPFS上ではピンを行わない。
- 他ノードがリプライ、リポスト、引用リポストした場合、それを行ったノードが投稿をピン。
- **ブックマーク機能**: ブックマークしたノードが投稿をピン。
- OrbitDBでのデータ管理:
  - 各ノードはフォローユーザーの投稿など関連データのみ保持。
  - データ競合時は最新データを優先。

---

## 7. UI/UX設計
- シンプルなデザインを基調とし、X（旧Twitter）のUIを参考。
- 初期段階では基本的な操作に絞った設計。

---

## 8. 将来の機能
- リアルタイムチャット機能。
- 検索機能。
- 信頼スコアシステム:
  - ユーザー信頼スコア。
  - AI信頼スコア: ローカルAIの活動に基づく信頼評価。

---

## 9. 技術スタック
- **フロントエンド**: ReactNativeExpo, ReactNativeWeb。
- **バックエンド**: Node.js, Python。
- **データベース**: OrbitDB, SQLite。
- **ネットワーク**: IPFS。
- **クロスプラットフォーム**: Electron。

---

## 10. 課題と対策
### 10.1 サーバー消失時のリスク
- 対策: IPFSバックアップを利用した復元。

### 10.2 P2Pネットワークの課題
- 対策: 信頼スコアや認証機構の強化。

### 10.3 データ競合
- 対策: OrbitDBのログを基に最新データを優先。
